<!DOCTYPE html> 
{% load static %}
<html lang="en">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <script src="{% static 'chart.js' %}"></script>
    <script src="{% static 'chartjs-plugin-annotation.js' %}"></script>
    <script src="{% static 'p5.js' %}"></script>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" 
        crossorigin="anonymous">
        <title>Real-Time app with Django Channels</title>
  

    </head>


    <script>

        // change these values to update default threshold lines on graphs, and max and min values for graphs
        var temp_min_graph_val = 10;
        var temp_max_graph_val = 50;
        var temp_threshold_val = 30;
        
        var acc_min_graph_val = -20;
        var acc_max_graph_val = 20;
        var acc_threshold_val = 10;

        var sound_min_graph_val = 0;
        var sound_max_graph_val = 4;
        var sound_threshold_val = 2;

        var force_min_graph_val = 0;
        var force_max_graph_val = 30;
        var force_threshold_val = 15;

        var PIR_max_graph_val = 1;
        var PIR_min_graph_val = 0;
        var PIR_threshold_val = 0.8;

        var photodiode_min_graph_val = 0;
        var photodiode_max_graph_val = 4;
        var photodiode_threshold_val = 2;

        var photoresistor_min_graph_val = 0;
        var photoresistor_max_graph_val = 4;
        var photoresistor_threshold_val = 2;

        var time_interval = 0.5; // increment golbal time counter by amount here 
    </script>

    <style>
    h4 {
        display: inline-block;
        text-align: center;
        
    }

    button {
        padding: 10px 20px;
        margin: 5px;
        background-color: gray;
        color: #fff;
        border: none;    
        outline: none;
        border-radius: 5px;
     }

    </style>

    <body>
        <!-- <form action="/exportcsv" style="margin: auto; width: 220px;"> -->
            <button style="background-color: red" id="export" type="submit" onclick="exportCSVFile()" >Stop and Export CSV</button>
        <!-- </form> -->

        <div class="container">
            <div class="row">

                    <form id="thresholdForm" action="/action_page.php">
                        <br><br>
                        <label for="maxForceThresh">Force Threshold:</label>
                        <input type="text" id="maxForceThresh" name="maxForceThresh" maxlength="10" size="6">
                    
                        <label for="accThresh">ACC Threshold:</label>
                        <input type="text" id="accThresh" name="accThresh" maxlength="10" size="6">
                    
                        <label for="PIRThresh">PIR Threshold    :</label>
                        <input type="text" id="PIRThresh" name="PIRThresh" maxlength="10" size="6"><br><br>
                    
                        <label for="photoDiodeThresh">Photodiode Threshold    :</label>
                        <input type="text" id="photoDiodeThresh" name="photoDiodeThresh" maxlength="10" size="6">
                    
                        <label for="photoResistorThresh">Photoresistor Threshold:</label>
                        <input type="text" id="photoResistorThresh" name="photoResistorThresh" maxlength="10" size="6">
                    
                        <label for="tempThresh">Temperature Threshold:</label>
                        <input type="text" id="tempThresh" name="tempThresh" maxlength="10" size="6"><br><br>
                    
                        <label for="soundThresh">Sound Threshold:</label>
                        <input type="text" id="soundThresh" name="soundThresh" maxlength="10" size="6"><br><br>
                    </form>
                    <button onclick="updateThreshold()">Update Threshold</button>

                <div>
                    <button id="PhotoDiodeButton" onclick="togglePhotoDiode(this)">Hide Photo Diode</button>
                    <button id="IRCameraButton" onclick="toggleIRCamera(this)">Hide IR Camera</button>
                    <button id = "MaxForceButton" onclick="toggleMaxForce(this)">Hide Max Force</button>
                    <button id = "PhotoResistorButton" onclick="togglePhotoResistor(this)">Hide Photo Resistor</button>
                    <button id = "ForceBarsButton" onclick="toggleForceBars(this)">Hide Force Bars</button>
                    <button id = "AccelerometerButton" onclick="toggleAcc(this)">Hide Accelerometer</button>
                    <button id = "TemperatureButton" onclick="toggleTemperature(this)">Hide Temperature</button>
                    <button id = "SoundButton" onclick="toggleSound(this)">Hide Sound</button>
                    <button id = "PIRButton" onclick="togglePIR(this)">Hide PIR</button>
                </div>
                
                    <script>
                        PhotoDiodeButton.style.backgroundColor = 'rgb(235, 168, 52)'
                        IRCameraButton.style.backgroundColor = 'blue'
                        MaxForceButton.style.backgroundColor = 'rgb(125, 172, 149)'
                        PhotoResistorButton.style.backgroundColor = 'green'
                        ForceBarsButton.style.backgroundColor = 'rgb(121, 91, 171)'
                        AccelerometerButton.style.backgroundColor = 'rgb(219, 206, 141)'
                        TemperatureButton.style.backgroundColor = 'rgb(255, 99, 132)'
                        SoundButton.style.backgroundColor = 'rgb(140, 163, 219)'
                        PIRButton.style.backgroundColor = 'rgb(157, 174, 117)'

                    </script>


                <style>
                    .container {
		                width: 80%;
		                margin: auto;
	                }
                    #ACC {
                        border: thick solid black;
                    }
                    #TEMP {
                        border: thick solid black;
                    }
                    #FORCEBAR {
                        border: thick solid black;
                    }
                    #MAXFORCE {
                        border: thick solid black;
                    }
                    #PHOTODIODE {
                        border: thick solid black;
                    }
                    #PHOTORESISTOR {
                        border: thick solid black;
                    }
                    #PIR {
                        border: thick solid black;
                    }
                    #SOUND {
                        border: thick solid black;
                    }

                </style>


                 <div class="container"> 

                    <div id="ACC" style="display: inline-block">
                        <canvas id="myChartAcc" width="400px" height="200px"></canvas>
                           
                        <p1 id="accx">{{ text }}</p1>
                        <p1 id="accy">{{ text }}</p1>
                        <p1 id="accz">{{ text }}</p1>
                    </div>

                
                    <div id="TEMP" style="display: inline-block">
                        <canvas id="myChartTemp" width="400px" height="200px"></canvas>
                        <p1 id="temp">{{ text }}</p1>
                    </div>
                    
                    
                    <div id="SOUND" style="display: inline-block">
                        <canvas id="myChartSound" width="400px" height="200px"></canvas>
                        <p1 id="sound">{{ text }}</p1>
                    </div>

                    <div id="FORCEBAR" style="display: inline-block">
                        <canvas id="myChartForceBar" width="400px" height="200px"></canvas>
                        <p1 id="leftForce">{{ text }}</p1>
                        <p1 id="rightForce">{{ text }}</p1>
                        <p1 id="topForce">{{ text }}</p1>
                        <p1 id="bottomForce">{{ text }}</p1>
                    </div>

                    <div id="MAXFORCE" style="display: inline-block">
                        <canvas id="myChartForceMaxLine" width="400px" height="200px"></canvas>
                        <p1 id="maxForce">{{ text }}</p1>
                    </div>

                    <div id="PIR" style="display: inline-block">
                        <canvas id="myChartPIR" width="400px" height="200px"></canvas>
                        <p1 id="pir">{{ text }}</p1>
                    </div>

                    
                    <div id="PHOTODIODE" style="display: inline-block">
                        <canvas id="myChartPhotoDiode" width="400px" height="200px"></canvas>
                        <p1 id="photoDiode">{{ text }}</p1>
                    </div>

                    <div id="PHOTORESISTOR" style="display: inline-block">
                        <canvas id="myChartPhotoResistor" width="400px" height="200px"></canvas>
                        <p1 id="photoResistor">{{ text }}</p1>
                    </div>

                </div>
            </div>
        </div>
        <script>
            // update threshold lines on graphs
            function updateThreshold() {
                var x = document.getElementById("thresholdForm");
                if (x.elements[0].value != '') {
                    myChartForceMaxLine.options.plugins.annotation.annotations.line1.yMax = x.elements[0].value;
                    myChartForceMaxLine.options.plugins.annotation.annotations.line1.yMin = x.elements[0].value;
                    myChartForceBar.options.plugins.annotation.annotations.line1.yMax = x.elements[0].value;
                    myChartForceBar.options.plugins.annotation.annotations.line1.yMin = x.elements[0].value;
                    myChartForceMaxLine.update();
                    myChartForceBar.update();
                }

                if (x.elements[1].value != '') {
                    myChartAcc.options.plugins.annotation.annotations.line1.yMax = x.elements[1].value;
                    myChartAcc.options.plugins.annotation.annotations.line1.yMin = x.elements[1].value;
                    myChartAcc.options.plugins.annotation.annotations.line2.yMax = -(x.elements[1].value);
                    myChartAcc.options.plugins.annotation.annotations.line2.yMin = -(x.elements[1].value);
                    myChartAcc.update();
                }

                if (x.elements[2].value != '') {
                    myChartPIR.options.plugins.annotation.annotations.line1.yMax = x.elements[2].value;
                    myChartPIR.options.plugins.annotation.annotations.line1.yMin = x.elements[2].value;
                    myChartPIR.update();
                }

                if (x.elements[3].value != '') {
                    myChartPhotoDiode.options.plugins.annotation.annotations.line1.yMax = x.elements[3].value;
                    myChartPhotoDiode.options.plugins.annotation.annotations.line1.yMin = x.elements[3].value;
                    myChartPhotoDiode.update();
                }

                if (x.elements[4].value != '') {
                    myChartPhotoResistor.options.plugins.annotation.annotations.line1.yMax = x.elements[4].value;
                    myChartPhotoResistor.options.plugins.annotation.annotations.line1.yMin = x.elements[4].value;
                    myChartPhotoResistor.update();
                }

                if (x.elements[5].value != '') {
                    myChartTemp.options.plugins.annotation.annotations.line1.yMax = x.elements[5].value;
                    myChartTemp.options.plugins.annotation.annotations.line1.yMin = x.elements[5].value;
                    myChartTemp.update();
                }

                if (x.elements[6].value != '') {
                    myChartSound.options.plugins.annotation.annotations.line1.yMax = x.elements[6].value;
                    myChartSound.options.plugins.annotation.annotations.line1.yMin = x.elements[6].value;
                    myChartSound.update();
                }
            }


            // create chart for acceleration
            const ctx = document.getElementById('myChartAcc');
            const myChartAcc = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ACC X',
                        data: [],
                        backgroundColor: 'rgb(219, 206, 141)',
                        borderColor: 'rgb(219, 206, 141)',
                        borderWidth: 1
                    },
                    {
                        label: 'ACC Y',
                        data: [],
                        backgroundColor: 'rgb(153, 220, 211)',
                        borderColor: 'rgb(153, 220, 211)',
                        borderWidth: 1
                    },
                    {
                        label: 'ACC Z',
                        data: [],
                        backgroundColor: 'rgb(200, 138, 219)',
                        borderColor: 'rgb(200, 138, 219)',
                        borderWidth: 1
                    },
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: acc_threshold_val,
                                yMax: acc_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                },
                                line2: {
                                type: 'line',
                                yMin: -acc_threshold_val,
                                yMax: -acc_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },

                    responsive: false,
                    scales: {
                        y: {
                            suggestedMin: acc_min_graph_val,
                            suggestedMax: acc_max_graph_val
                        }
                    }
                }
            });

            // create chart for temperature
            const ctx2 = document.getElementById('myChartTemp');
            const myChartTemp = new Chart(ctx2, {
                type: 'line', 
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Temperature',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(255, 99, 132)',
                        borderColor: 'rgb(255, 99, 132)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: temp_threshold_val,
                                yMax: temp_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },

                    responsive: false,
                    scales: {
                        y: {
                            suggestedMin: temp_min_graph_val,
                            suggestedMax: temp_max_graph_val
                        }
                    }
                }
            });
            
            


            // create chart for sound
            const ctx3 = document.getElementById('myChartSound');
            const myChartSound = new Chart(ctx3, {
                type: 'line', // removed to make bar graph
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sound',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(140, 163, 219)',
                        borderColor: 'rgb(140, 163, 219)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: sound_threshold_val,
                                yMax: sound_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },

                    responsive: false,
                    scales: {
                        y: {
                            min: sound_min_graph_val,
                            suggestedMax: sound_max_graph_val
                        }
                    }
                }
            });

            // create chart for force bar graphs
            const ctx4 = document.getElementById('myChartForceBar');
            const myChartForceBar = new Chart(ctx4, {
                type: 'bar', // added to make bar graph
                //type: 'line', // removed to make bar graph
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Left Force Sensor',
                        data: [],
                        backgroundColor: 'rgb(121, 91, 171)',
                        borderColor: 'rgb(121, 91, 171)',
                        borderWidth: 1
                    },
                    {
                        label: 'Right Force Sensor',
                        data: [],
                        backgroundColor: 'rgb(124, 195, 230)',
                        borderColor: 'rgb(124, 195, 230)',
                        borderWidth: 1
                    },
                    {
                        label: 'Top Force Sensor',
                        data: [],
                        backgroundColor: 'rgb(215, 88, 138)',
                        borderColor: 'rgb(215, 88, 138)',
                        borderWidth: 1
                    },
                    {
                        label: 'Bottom Force Sensor',
                        data: [],
                        backgroundColor: 'rgb(241, 183, 72)',
                        borderColor: 'rgb(241, 183, 72)',
                        borderWidth: 1
                    },
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: force_threshold_val,
                                yMax: force_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },
                    responsive: false,
                    scales: {
                        y: {
                            min: force_min_graph_val,
                            suggestedMax: force_max_graph_val
                        }
                    }
                }
            });
        
            // create chart for max force
            const ctx5 = document.getElementById('myChartForceMaxLine');
            const myChartForceMaxLine = new Chart(ctx5, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Max Force Value',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(125, 172, 149)',
                        borderColor: 'rgb(125, 172, 149)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: force_threshold_val,
                                yMax: force_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: force_min_graph_val,
                            suggestedMax: force_max_graph_val
                        }
                    }
                }
            });
            
            // create chart for PIR
            const ctx6 = document.getElementById('myChartPIR');
            const myChartPIR = new Chart(ctx6, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'PIR',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(157, 174, 117)',
                        borderColor: 'rgb(157, 174, 117)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: PIR_threshold_val,
                                yMax: PIR_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            suggestedMin: PIR_min_graph_val,
                            suggestedMax: PIR_max_graph_val
                        }
                    }
                }
            });



            // create chart for photo diode
            const ctx7 = document.getElementById('myChartPhotoDiode');
            const myChartPhotoDiode = new Chart(ctx7, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Photo Diode',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(235, 168, 52)',
                        borderColor: 'rgb(235, 168, 52)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: photodiode_threshold_val,
                                yMax: photodiode_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },

                    scales: {
                        y: {
                            suggestedMin: photodiode_min_graph_val,
                            suggestedMax: photodiode_max_graph_val
                        }
                    }
                }
            });

            // create chart for photo resistor
            const ctx8 = document.getElementById('myChartPhotoResistor');
            const myChartPhotoResistor = new Chart(ctx8, {
                type: 'line', // removed to make bar graph
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Photo Resistor',
                        tension: 0.3,
                        data: [],
                        backgroundColor: 'rgb(35, 138, 52)',
                        borderColor: 'rgb(35, 138, 52)',
                        borderWidth: 1
                    }
                ]
                    
                },
                options: {
                    plugins: {
                    autocolors: false,
                        annotation: {
                            annotations: {
                                line1: {
                                type: 'line',
                                yMin: photoresistor_threshold_val,
                                yMax: photoresistor_threshold_val,
                                borderColor: 'rgb(245, 66, 66)',
                                borderWidth: 4,
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            suggestedMin: photoresistor_min_graph_val,
                            suggestedMax: photoresistor_max_graph_val
                        }
                    }
                }
            });
            

            var count;
            var maxForceArr = [];
            var maxForceVal;
            var displayFreq = 1;

            // final value from force setup screen used to zero force sensors
            var prevTopForceVal = sessionStorage.getItem("finalTopForceVal");
            var prevBottomForceVal = sessionStorage.getItem("finalBottomForceVal");
            var prevLeftForceVal = sessionStorage.getItem("finalLeftForceVal");
            var prevRightForceVal = sessionStorage.getItem("finalRightForceVal");

    
            console.log(prevTopForceVal);
            console.log(prevBottomForceVal);
            console.log(prevLeftForceVal);
            console.log(prevRightForceVal);

            // data for graphs
            const myData = [];
            const myDataLeftForce = [];
            const myDataRightForce = [];
            const myDataTopForce = [];
            const myDataBottomForce = [];
            const myDataTemp = [];
            const myDataSound = [];
            const myDataX = [];
            const myDataY = [];
            const myDataZ = [];
            const myDataPIR = [];
            const myDataPhotoDiode = [];
            const myDataPhotoResistor = [];
            var IRCameraData = [];
            
            // time counter and x value to be displayed on graph
            var time_counter = 0;
            const time_axis = [];

            // create websocket
            const socket = new WebSocket (
                'ws://' + window.location.host + '/ws/matserver/'
            );

            socket.onmessage = function(event) {
                var data = JSON.parse(event.data); //data.<dictionary key>
                
                for (let i = 0; i < data.length; i++){
                    if (data[i].sensor == 'ircamera') {
                        //document.querySelector('#ir_frame').innerText = "Z: " + data.value[0] + " m/s/s";
                        IRCameraData = data[i].value;
                    }
                    else if(data[i].sensor == 'temp') {
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#temp').innerText = "\xa0\xa0\xa0\xa0 Temperature = " + data[i].value + " C"; //JSON.stringify(data);
                        }
                        myDataTemp.push(data[i].value);
                        time_axis.push(time_counter);
                        myChartTemp.data.labels.push(time_counter.toString());
                        
                        time_counter++; // global time counter
                        myChartTemp.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartTemp.data.labels.shift();
                            }
                            
                            dataset.data.push(myDataTemp[myDataTemp.length-1]);
                        });
                        myChartTemp.update(); // 'none' removes animations
                        //console.log(myDataTemp);
                    }       
                    else if(data[i].sensor == 'sound') {
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#sound').innerText = "\xa0\xa0\xa0\xa0 Sound = " + data[i].value + " Units"; //JSON.stringify(data);
                        }
                        myDataSound.push(data[i].value);
                        time_axis.push(time_counter);

                        myChartSound.data.labels.push(time_counter.toString());
                        
                        myChartSound.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartSound.data.labels.shift();
                            }

                            dataset.data.push(myDataSound[myDataSound.length-1]);
                        });
                        myChartSound.update(); // 'none' removes animations
                        //console.log(myDataSound);
                    }
                    else if (data[i].sensor == 'accx') {
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#accx').innerText = "\xa0\xa0\xa0\xa0 X: " + data[i].value + " m/s/s";
                        }
                        myDataX.push(data[i].value);
                        //time_axis.push(time_counter++);
                        myChartAcc.data.labels.pop(); // added to make bar graph
                        myChartAcc.data.labels.push(time_counter.toString());
                        
                        myChartAcc.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'ACC X') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataX[myDataX.length-1]);
                            }
                        });
                        myChartAcc.update('none');
                        //console.log(myDataY);
                    }
                    else if (data[i].sensor == 'accy') {
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#accy').innerText = "\xa0\xa0\xa0\xa0 Y: " + data[i].value + " m/s/s";
                        }
                        myDataY.push(data[i].value);
                        //time_axis.push(time_counter++);
                        myChartAcc.data.labels.pop(); // added to make bar graph
                        myChartAcc.data.labels.push(time_counter.toString());

                        myChartAcc.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'ACC Y') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataY[myDataY.length-1]);
                            }
                        });
                        myChartAcc.update('none');
                        
                        //console.log(myDataY);
                        
                    }
                    else if (data[i].sensor == 'accz') {
                        document.querySelector('#accz').innerText = "\xa0\xa0\xa0\xa0 Z: " + data[i].value + " m/s/s      ";
                        
                        myDataZ.push(data[i].value);
                        //time_axis.push(time_counter++);
                        myChartAcc.data.labels.pop(); // added to make bar graph
                        myChartAcc.data.labels.push(time_counter.toString());
                        
                        //time_counter++;
                        myChartAcc.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'ACC Z') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataZ[myDataZ.length-1]);
                            }
                        });
                        
                        myChartAcc.update('none'); // 'none' removes animations
                        //console.log(myDataZ);
                        
                    }           
                    else if (data[i].sensor == 'leftForce') {
                        document.querySelector('#leftForce').innerText = "\xa0\xa0\ L: " + (data[i].value-prevLeftForceVal).toFixed(2) + " lbs";
                        
                        myDataLeftForce.push((data[i].value-prevLeftForceVal).toFixed(2));
                        //time_axis.push(time_counter++);
                        myChartForceBar.data.labels.pop(); // added to make bar graph
                        myChartForceBar.data.labels.push(time_counter.toString());
                        
                        //time_counter++;
                        myChartForceBar.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'Left Force Sensor') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataLeftForce[myDataLeftForce.length-1]);
                            }
                        });
                        

                        myChartForceBar.update('none'); // 'none' removes animations
                        //console.log(myDataZ);

                        // UPDATE ARRAY FOR MAX ARRAY VALUE
                        maxForceArr.push(data[i].value-prevLeftForceVal);
                    }
                    else if (data[i].sensor == 'rightForce') {
                        
                        document.querySelector('#rightForce').innerText = "\xa0\xa0 R: " + (data[i].value-prevRightForceVal).toFixed(2) + " lbs";
                        
                        myDataRightForce.push((data[i].value-prevRightForceVal).toFixed(2));
                        //time_axis.push(time_counter++);
                        myChartForceBar.data.labels.pop(); // added to make bar graph
                        myChartForceBar.data.labels.push(time_counter.toString());
                        
                        //time_counter++;
                        myChartForceBar.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'Right Force Sensor') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataRightForce[myDataRightForce.length-1]);
                            }
                        });

                        myChartForceBar.update('none'); // 'none' removes animations
                        //console.log(myDataZ);

                        // UPDATE ARRAY FOR MAX FORCE VAL
                        maxForceArr.push(data[i].value-prevRightForceVal);
                    }
                    else if (data[i].sensor == 'topForce') {
                        document.querySelector('#topForce').innerText = "\xa0\xa0\ T: " + (data[i].value-prevTopForceVal).toFixed(2) + " lbs";
                        
                        myDataTopForce.push((data[i].value-prevTopForceVal).toFixed(2));
                        //time_axis.push(time_counter++);
                        myChartForceBar.data.labels.pop(); // added to make bar graph
                        myChartForceBar.data.labels.push(time_counter.toString());
                        
                        //time_counter++;
                        myChartForceBar.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'Top Force Sensor') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataTopForce[myDataTopForce.length-1]);
                            }
                        });
                        

                        myChartForceBar.update('none'); // 'none' removes animations
                        //console.log(myDataZ);

                        // UPDATE ARRAY FOR MAX FORCE VALUE
                        maxForceArr.push(data[i].value-prevTopForceVal);
                    }
                    else if (data[i].sensor == 'bottomForce') {
                        document.querySelector('#bottomForce').innerText = "\xa0\xa0\ B: " + (data[i].value-prevBottomForceVal).toFixed(2) + " lbs";
                        
                        myDataBottomForce.push((data[i].value-prevBottomForceVal).toFixed(2));
                        
                        myChartForceBar.data.labels.pop(); // added to make bar graph
                        myChartForceBar.data.labels.push(time_counter.toString());
                    
                        myChartForceBar.data.datasets.forEach((dataset) => {
                            if (dataset.label == 'Bottom Force Sensor') {
                                dataset.data.pop(); // added to make bar graph
                                dataset.data.push(myDataBottomForce[myDataBottomForce.length-1]);
                            }
                        });
                        

                        myChartForceBar.update('none'); // 'none' removes animations
                        //console.log(myDataZ);

                        // update MAX FORCE VALUE GRAPH
                        maxForceArr.push(data[i].value-prevBottomForceVal);
                        maxForceVal = Math.max( ...maxForceArr );

                        document.querySelector('#maxForce').innerText = "\xa0\xa0\xa0\xa0 Max Force: " + maxForceVal.toFixed(2) + " lbs";

                        myData.push(maxForceVal);
                        time_axis.push(time_counter);
                        //myChartTemp.data.labels.pop(); // added to make bar graph
                        myChartForceMaxLine.data.labels.push(time_counter.toString());
                        

                        myChartForceMaxLine.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartForceMaxLine.data.labels.shift();
                            }
                            
                        //   dataset.data.pop(); // added to make bar graph
                            dataset.data.push(myData[myData.length-1]);
                        });
                        myChartForceMaxLine.update(); // 'none' removes animations
                        //console.log(myData);fb
                        maxForceArr = [];

                    }
                    else if (data[i].sensor == 'pir') {                
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#pir').innerText = "\xa0\xa0\xa0\xa0 PIR = " + data[i].value + " Units"; //JSON.stringify(data);
                        }
                        myDataPIR.push(data[i].value);
                        time_axis.push(time_counter);
                        myChartPIR.data.labels.push(time_counter.toString());
                        
                        myChartPIR.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartPIR.data.labels.shift();
                            }
                            
                            dataset.data.push(myDataPIR[myDataPIR.length-1]);
                        });
                        myChartPIR.update(); // 'none' removes animations
                        //console.log(myDataPIR);
                    }               
                    else if (data[i].sensor == 'photoDiode') {                
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#photoDiode').innerText = "\xa0\xa0\xa0\xa0 Photo Diode = " + data[i].value + " Units"; //JSON.stringify(data);
                        }
                        myDataPhotoDiode.push(data[i].value);
                        time_axis.push(time_counter);
                        myChartPhotoDiode.data.labels.push(time_counter.toString());
                        
                        myChartPhotoDiode.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartPhotoDiode.data.labels.shift();
                            }
                            
                            dataset.data.push(myDataPhotoDiode[myDataPhotoDiode.length-1]);
                        });
                        myChartPhotoDiode.update(); // 'none' removes animations
                        //console.log(myDataPhotoDiode);
                    }
                    else if (data[i].sensor == 'photoResistor') {                
                        if (time_counter % displayFreq == 0) { 
                            document.querySelector('#photoResistor').innerText = "\xa0\xa0\xa0\xa0 Photo Resistor = " + data[i].value + " Units"; //JSON.stringify(data);
                        }
                        myDataPhotoResistor.push(data[i].value);
                        time_axis.push(time_counter);
                        myChartPhotoResistor.data.labels.push(time_counter.toString());
                        
                        myChartPhotoResistor.data.datasets.forEach((dataset) => {
                            if (dataset.data.length > 50) {
                                dataset.data.shift();
                                myChartPhotoResistor.data.labels.shift();
                            }
                            
                            dataset.data.push(myDataPhotoResistor[myDataPhotoResistor.length-1]);
                        });
                        myChartPhotoResistor.update(); // 'none' removes animations
                        //console.log(myDataPhotoResistor);
                    }
                }
            }

            // Export data as csv file
            function exportCSVFile() {
                const csvData = [];
                var username = sessionStorage.getItem("USERNAME");
                var tool = sessionStorage.getItem("TOOL");
                var mat = sessionStorage.getItem("MAT");
                var filename = username + '_' + tool + '_' + mat + '.csv';
                    for (var i = 0; i < myDataPhotoDiode.length; i++) {

                        var tmpArr = [username, tool, mat, i, myDataLeftForce[i], myDataRightForce[i], myDataTopForce[i], myDataBottomForce[i], myDataTemp[i], myDataSound[i], myDataX[i], myDataY[i], myDataZ[i], myDataPIR[i], myDataPhotoDiode[i], myDataPhotoResistor[i]];
                        csvData.push(tmpArr);
                    }
                    console.log(csvData);

                    var csvContent = 'User,Tool,Material,Time(s),Left Force,Right Force,Top Force,Bottom Force,Temperature,Sound,X Acceleration,Y Acceleration,Z Acceleration,PIR,Photodiode,photoresistor\n'

                    csvData.forEach(function(row) {
                        csvContent += row.join(',');
                        csvContent += "\n";
                    });

                    console.log(csvData);
                    document.write(csvData);

                    var hiddenElement = document.createElement('a');
                    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvContent);
                    hiddenElement.target = '_blank';
                    hiddenElement.download = filename;
                    hiddenElement.click();
            }

            var IRCmaeraHiddenBool = 0;
            var canvas;
            function setup() {
                var scale_factor = 20;
                canvas = createCanvas(32*scale_factor, 24*scale_factor);

                var x = (windowWidth - width) / 2;  
            
                canvas.position(x, 10, 'relative');
                pixelDensity(0.05);
            }

            // function to draw IR frame
            function draw() {
                var count = 0;
                if (IRCmaeraHiddenBool) {
                    canvas.hide();
                }
                else {
                    canvas.show();
                }
                background(51);
                loadPixels();
        
                var scale_factor = 1;
                for (var y = 0; y < height; y+=scale_factor) {
                    for (var x = 0; x < width; x+=scale_factor) {
                    var index = (x + y * width) * 4;
                    if (IRCameraData[count] <= 25) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 206;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                        
                    }
                    else if (IRCameraData[count] > 25 && IRCameraData[count] <= 25.5) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 198;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 25.5 && IRCameraData[count] <= 26) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 163;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 26 && IRCameraData[count] <= 26.5) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 78;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 26 && IRCameraData[count] <= 26.5) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 78;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 26.5 && IRCameraData[count] <= 27) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 78;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 27 && IRCameraData[count] <= 28) {
                        pixels[index + 0] = 39;
                        pixels[index + 1] = 78;
                        pixels[index + 2] = 245;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 28 && IRCameraData[count] <= 30) {
                        pixels[index + 0] = 245;
                        pixels[index + 1] = 39;
                        pixels[index + 2] = 219;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 30 && IRCameraData[count] <= 32) {
                        pixels[index + 0] = 245;
                        pixels[index + 1] = 39;
                        pixels[index + 2] = 155;
                        pixels[index + 3] = 255;
                    }
                    else if (IRCameraData[count] > 32 && IRCameraData[count] <= 35) {
                        pixels[index + 0] = 245;
                        pixels[index + 1] = 39;
                        pixels[index + 2] = 95;
                        pixels[index + 3] = 255;
                    }
                    else {
                        pixels[index + 0] = 245;
                        pixels[index + 1] = 39;
                        pixels[index + 2] = 39;
                        pixels[index + 3] = 255;
                    }
                    count++;
                    }
                }
                updatePixels();
            }
        
        </script>

    <script>
    
    // button to hide and show PIR graph
    let togglePIR = button => {

        let canvasPIR = document.getElementById("PIR");
        let hiddenPIR = canvasPIR.getAttribute("hidden");

        const backgroundColor = PIRButton.style.backgroundColor;

        if (backgroundColor === 'rgb(157, 174, 117)') {
            PIRButton.style.backgroundColor = 'gray';
        }
        else {
            PIRButton.style.backgroundColor = 'rgb(157, 174, 117)'
        }

        if (hiddenPIR) {
            canvasPIR.removeAttribute("hidden");
            button.innerText = "Hide PIR";
        } 
        else {
            canvasPIR.setAttribute("hidden", "hidden");
            button.innerText = "Show PIR";
        }
    }

    </script>

    <script>

    let togglePhotoResistor = button => {

        let canvasPhotoResistor = document.getElementById("PHOTORESISTOR");
        let hiddenPhotoResistor = canvasPhotoResistor.getAttribute("hidden");

        const backgroundColor = PhotoResistorButton.style.backgroundColor;

        if (backgroundColor === 'green') {
            PhotoResistorButton.style.backgroundColor = 'gray';
        }
        else {
            PhotoResistorButton.style.backgroundColor = 'green'
        }
            

        if (hiddenPhotoResistor) {
            canvasPhotoResistor.removeAttribute("hidden");
            button.innerText = "Hide Photo Resistor";
        } 
        else {
            canvasPhotoResistor.setAttribute("hidden", "hidden");       
            button.innerText = "Show Photo Resistor";
        }
    }

    </script>


    <script>
    let toggleTemperature = button => {

        let canvasTemp = document.getElementById("TEMP");
        let hiddenTemp = canvasTemp.getAttribute("hidden");

        const backgroundColor = TemperatureButton.style.backgroundColor;

        if (backgroundColor === 'rgb(255, 99, 132)') {
            TemperatureButton.style.backgroundColor = 'gray';
        }
        else {
            TemperatureButton.style.backgroundColor = 'rgb(255, 99, 132)'
        }
            

        if (hiddenTemp) {
            canvasTemp.removeAttribute("hidden");
            button.innerText = "Hide Temperature";
        } 
        else {
            canvasTemp.setAttribute("hidden", "hidden");
            button.innerText = "Show Temperature";
        }
    }
    </script>

    <script>
    let toggleSound = button => {

        let canvasSound = document.getElementById("SOUND");
        let hiddenSound = canvasSound.getAttribute("hidden");

        const backgroundColor = SoundButton.style.backgroundColor;

        if (backgroundColor === 'rgb(140, 163, 219)') {
            SoundButton.style.backgroundColor = 'gray';
        }
        else {
            SoundButton.style.backgroundColor = 'rgb(140, 163, 219)'
        }

        if (hiddenSound) {
            canvasSound.removeAttribute("hidden");
            button.innerText = "Hide Sound";
        } 
        else {
            canvasSound.setAttribute("hidden", "hidden");
            button.innerText = "Show Sound";
        }
    }

    </script>


    <script>

    let toggleAcc = button => {

        let canvasAcc = document.getElementById("ACC");

        let hiddenAcc = canvasAcc.getAttribute("hidden");

        const backgroundColor = AccelerometerButton.style.backgroundColor;

        if (backgroundColor === 'rgb(219, 206, 141)') {
            AccelerometerButton.style.backgroundColor = 'gray';
        }
        else {
            AccelerometerButton.style.backgroundColor = 'rgb(219, 206, 141)'
        }

        if (hiddenAcc) {
            canvasAcc.removeAttribute("hidden");
            button.innerText = "Hide Accelerometer";
        } 
        else {
            canvasAcc.setAttribute("hidden", "hidden");
            button.innerText = "Show Accelerometer";
        }
    }

    </script>


    <script>

    let toggleForceBars = button => {

        let canvasForceBar = document.getElementById("FORCEBAR");
        let hiddenForceBar = canvasForceBar.getAttribute("hidden");

        const backgroundColor = ForceBarsButton.style.backgroundColor;

        if (backgroundColor === 'rgb(121, 91, 171)') {
            ForceBarsButton.style.backgroundColor = 'gray';
        }
        else {
            ForceBarsButton.style.backgroundColor = 'rgb(121, 91, 171)'
        }

        if (hiddenForceBar) {
            canvasForceBar.removeAttribute("hidden");
    

            button.innerText = "Hide Force Bars";
        } 
        else {
            canvasForceBar.setAttribute("hidden", "hidden");

            button.innerText = "Show Force Bars";
        }
    }

    </script>


    <script>

    let togglePhotoDiode = button => {

        let canvasPhotoDiode = document.getElementById("PHOTODIODE");
        let hiddenTemp = canvasPhotoDiode.getAttribute("hidden");

        const backgroundColor = PhotoDiodeButton.style.backgroundColor;

        if (backgroundColor === 'rgb(235, 168, 52)') {
            PhotoDiodeButton.style.backgroundColor = 'gray';
        }
        else {
            PhotoDiodeButton.style.backgroundColor = 'rgb(235, 168, 52)'
        }

        if (hiddenTemp) {
            canvasPhotoDiode.removeAttribute("hidden");
            button.innerText = "Hide Photo Diode";
        } 
        else {
            canvasPhotoDiode.setAttribute("hidden", "hidden");
            button.innerText = "Show Photo Diode";
        }
    }

    </script>

    </script>


    <script>

    let toggleMaxForce = button => {

        let canvasMaxForce = document.getElementById("MAXFORCE");
        let hiddenMaxForce = canvasMaxForce.getAttribute("hidden");

        const backgroundColor = MaxForceButton.style.backgroundColor;

        if (backgroundColor === 'rgb(125, 172, 149)') {
            MaxForceButton.style.backgroundColor = 'gray';
        }
        else {
            MaxForceButton.style.backgroundColor = 'rgb(125, 172, 149)'
        }

        if (hiddenMaxForce) {
            canvasMaxForce.removeAttribute("hidden");
            button.innerText = "Hide Max Force";
        } 
        else {
            canvasMaxForce.setAttribute("hidden", "hidden");
            button.innerText = "Show Max Force";
        }
    }

    </script>


    <script>

    let toggleIRCamera = button => {

        const backgroundColor = IRCameraButton.style.backgroundColor;

        if (backgroundColor === 'blue') {
            IRCameraButton.style.backgroundColor = 'gray';
        }
        else {
            IRCameraButton.style.backgroundColor = 'blue'
        }

        if (IRCmaeraHiddenBool) {
            IRCmaeraHiddenBool = 0;
            button.innerText = "Hide IR Camera";
        } 
        else {
            IRCmaeraHiddenBool = 1;
            button.innerText = "Show IR Camera";
        }
    }
    </script>
</body>
</html>